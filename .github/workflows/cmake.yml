name: Build and Deploy C++ WebAssembly

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Emscripten
      uses: mymindstorm/setup-emsdk@v11
      run: emcc -v

    - name: Create Build Directory
      run: mkdir build

    - name: CMake Configure and Build
      run: |
        cd build
        emcmake cmake ..
        cmake --build .

    # If you want to test using emrun before deploying (this won't display anything but will confirm if it runs without errors)
    - name: Test with emrun
      run: |
        cd web
        emrun --no_browser --port 8080 CuriousX.html & # Start in background
        sleep 10 # Give some time for the server to start and serve
        kill %1 # Kill background job

    - name: Deploy to GitHub Pages
      uses: JamesIves/github-pages-deploy-action@4.1.5
      with:
        branch: gh-pages
        folder: web
